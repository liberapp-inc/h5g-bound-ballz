var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(a,n){function r(t){try{h(s.next(t))}catch(e){n(e)}}function o(t){try{h(s["throw"](t))}catch(e){n(e)}}function h(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(r,o)}h((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,n&&(r=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,n=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(s){i=[6,s],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,n,r,o,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},__assign=this&&this.__assign||Object.assign||function(t){for(var e,i=1,s=arguments.length;s>i;i++){e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},GameObject=function(){function t(){this.shape=null,t.objects.push(this)}return t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.display=e},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t["delete"](),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t["delete"](),!1})},t.prototype["delete"]=function(){this.onDestroy(),this.shape&&(t.display.removeChild(this.shape),this.shape=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var Item=function(t){function e(i,s){var a=t.call(this)||this;return e.items.push(a),a.radius=BALL_RADIUS_PER_WIDTH*Util.width*.8,a.setShape(i,s,a.radius),a}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.items=e.items.filter(function(e){return e!=t})},e.prototype.setShape=function(t,e,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(49407),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,2),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){var t=this;Ball.balls.some(function(e,i){var s=e.shape.x-t.shape.x,a=e.shape.y-t.shape.y;return Math.pow(s,2)+Math.pow(a,2)<=Math.pow(e.radius+t.radius,2)?(Aiming.I.addBall(),new EffectCircle(t.shape.x,t.shape.y,t.radius,49407),t.destroy(),!0):!1})},e.scrollUp=function(t){e.items.forEach(function(e){e.shape.y+=t,e.shape.y<=0&&e.destroy()})},e.items=[],e}(GameObject);__reflect(Item.prototype,"Item");var Ball=function(t){function e(i,s,a,n){var r=t.call(this)||this;return e.balls.push(r),r.radius=BALL_SIZE_PER_WIDTH*Util.width*.5,r.setShape(i,s,r.radius),r.vx=a,r.vy=n,r}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.balls=e.balls.filter(function(e){return e!=t})},e.prototype.setShape=function(t,e,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(49407),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){var t=this;this.shape.x+=this.vx,this.shape.y+=this.vy,this.vx*=.99,this.vy*=.99,this.vy+=.01*this.radius;var e=null,i=0;if(Target.targets.forEach(function(s){var a=s.shape.x-t.shape.x,n=s.shape.y-t.shape.y,r=Math.pow(a,2)+Math.pow(n,2);if(e)i>r&&(e=s,i=r);else{var o=Math.pow(s.radius+t.radius,2);o>r&&(e=s,i=r)}}),e){var s=this.shape.x-e.shape.x,a=this.shape.y-e.shape.y,n=Math.sqrt(Math.pow(s,2)+Math.pow(a,2)),r=s/n,o=a/n,h=r*this.vx+o*this.vy;if(0>h){this.vx+=-1.8*h*r,this.vy+=-1.8*h*o;var l=.2*this.radius;n=Math.pow(this.vx,2)+Math.pow(this.vy,2),n<Math.pow(l,2)&&(n=l/Math.sqrt(n),this.vx*=n,this.vy*=n),e.applyDamage(1,-r,-o)}}this.boundWall()},e.prototype.boundWall=function(){Math.pow(this.shape.x-.5*Util.width,2)>Math.pow(.5*Util.width-this.radius,2)&&(this.vx*=-.9,this.shape.x+=this.vx),this.vy<0&&this.shape.y<this.radius&&(this.vy*=-.9,this.shape.y+=this.vy),this.shape.y>Util.height&&this.destroy()},e.balls=[],e}(GameObject);__reflect(Ball.prototype,"Ball");var EffectCircle=function(t){function e(i,s,a,n){void 0===n&&(n=16760832);var r=t.call(this)||this;return r.frame=e.maxFrame,r.radius=a,r.color=n,r.setShape(i,s,r.radius),r}return __extends(e,t),e.prototype.setShape=function(t,i,s){null==this.shape?(this.shape=new egret.Shape,GameObject.display.addChild(this.shape)):this.shape.graphics.clear(),this.shape.x=t,this.shape.y=i,this.shape.graphics.lineStyle(3+10*(this.frame/e.maxFrame),this.color),this.shape.graphics.drawCircle(0,0,s)},e.prototype.update=function(){return--this.frame<=0?void this.destroy():(this.radius*=1.03,void this.setShape(this.shape.x,this.shape.y,this.radius))},e.maxFrame=30,e}(GameObject);__reflect(EffectCircle.prototype,"EffectCircle");var EffectLine=function(t){function e(e,i,s,a,n){void 0===n&&(n=16760832);var r=t.call(this)||this;return r.frame=0,r.x=e,r.y=i,r.vx=s,r.vy=a,r.color=n,r.setShape(0),r}return __extends(e,t),e.prototype.setShape=function(t){null==this.shape?(this.shape=new egret.Shape,GameObject.display.addChild(this.shape)):this.shape.graphics.clear(),t=t*Math.PI*.5;var e=Math.sin(t),i=1-Math.cos(t);this.shape.graphics.lineStyle(10,this.color),this.shape.graphics.moveTo(this.x+this.vx*e,this.y+this.vy*e),this.shape.graphics.lineTo(this.x+this.vx*i,this.y+this.vy*i)},e.prototype.update=function(){if(++this.frame>=e.maxFrame)return void this.destroy();var t=this.frame/e.maxFrame;this.setShape(t)},e.maxFrame=30,e}(GameObject);__reflect(EffectLine.prototype,"EffectLine");var BALL_SIZE_PER_WIDTH=1/16,BALL_RADIUS_PER_WIDTH=.5*BALL_SIZE_PER_WIDTH,TARGET_SIZE_PER_WIDTH=1/6,TARGET_RADIUS_PER_WIDTH=.5*TARGET_SIZE_PER_WIDTH,Game=function(){function t(){}return t.loadSceneGamePlay=function(){new Background,new Score,new Aiming},t}();__reflect(Game.prototype,"Game");var Aiming=function(t){function e(){var i=t.call(this)||this;return i.lineColor=33023,i.dir=0,i.ballMax=9,i.ballCount=2,i.interval=0,i.rowCount=0,i.state=i.stateWave,i.step=120,i.shapeLine=null,i.textGuide=null,i.textBalls=null,e.I=i,i.x=.5*Util.width,i.y=.1*Util.height,i.ballSpeed=BALL_RADIUS_PER_WIDTH*Util.width*.75,i.shapeLine=new egret.Shape,i.shapeLine.graphics.beginFill(49407),i.shapeLine.graphics.drawCircle(i.x,i.y,BALL_RADIUS_PER_WIDTH*Util.width*.75),i.shapeLine.graphics.endFill(),i.shapeLine.graphics.lineStyle(5,8421520),i.shapeLine.graphics.moveTo(0,i.y),i.shapeLine.graphics.lineTo(.45*Util.width,i.y),i.shapeLine.graphics.moveTo(.55*Util.width,i.y),i.shapeLine.graphics.lineTo(Util.width,i.y),GameObject.display.addChild(i.shapeLine),i.textGuide=Util.newTextField("スワイプでねらって\nボールをおとせ！",Util.width/18,33023,.5,.3,!0),i.textBalls=Util.newTextField("x"+i.ballCount,Util.width/22,33023,.55,.06,!0),GameObject.display.addChild(i.textGuide),GameObject.display.addChild(i.textBalls),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return i.onTapToStart()},i),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return i.touchBegin(t)},i),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return i.touchMove(t)},i),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_END,function(t){return i.touchEnd(t)},i),i}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.onTapToStart()},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return t.touchBegin(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){return t.touchMove(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_END,function(e){return t.touchEnd(e)},this),this.shapeLine&&(GameObject.display.removeChild(this.shapeLine),this.shapeLine=null),this.textGuide&&(GameObject.display.removeChild(this.textGuide),this.textGuide=null),this.textBalls&&(GameObject.display.removeChild(this.textBalls),this.textBalls=null),e.I=null},e.prototype.setShape=function(){null==this.shape?(this.shape=new egret.Shape,GameObject.display.addChild(this.shape)):this.shape.graphics.clear();var t=(15&this.step)/16,e=this.x,i=this.y,s=Math.sin(this.dir)*this.ballSpeed,a=Math.cos(this.dir)*this.ballSpeed,n=BALL_RADIUS_PER_WIDTH*Util.width;this.shape.graphics.lineStyle(5*t,this.lineColor),e+=s*t,i+=a*t,s*=1-.01*t,a*=1-.01*t,a+=.01*n*t,this.shape.graphics.drawCircle(e,i,.02*n),this.shape.graphics.lineStyle(5,this.lineColor);for(var r=0;20>r;r++)e+=s,i+=a,s*=.99,a*=.99,a+=.01*n,this.shape.graphics.drawCircle(e,i,.02*n);this.shape.graphics.lineStyle(5*(1-t),this.lineColor),e+=s,i+=a,s*=.99,a*=.99,a+=.01*n,this.shape.graphics.drawCircle(e,i,.02*n)},e.prototype.setDir=function(t,e){var i=this.x,s=this.y,a=t-i,n=e-s;0>n&&(n=0),this.dir=Util.clamp(Math.atan2(a,n),.45*-Math.PI,.45*+Math.PI)},e.prototype.update=function(){this.state()},e.prototype.stateNone=function(){},e.prototype.stateWave=function(){if(this.step>0)return void this.step--;Score.I.combo=0,this.rowCount++;for(var t=Util.clamp(1-this.rowCount/30,.45,1),e=Util.height+TARGET_RADIUS_PER_WIDTH*Util.width,i=Math.min(.75*this.rowCount+1,Target.maxHp),s=t*Util.random(0,1);1>s;){var a=Util.width*(TARGET_RADIUS_PER_WIDTH+s*(1-TARGET_SIZE_PER_WIDTH));this.ballCount<this.ballMax&&2==Util.randomInt(0,3)?new Item(a,e):new Target(a,e,Util.randomInt(Math.max(1,.33*i),i)),s+=t*Util.random(.5,1.5)}this.state=this.stateScroll,this.step=0},e.prototype.stateScroll=function(){this.step++;var t=30,i=TARGET_SIZE_PER_WIDTH*Util.width*-1.25,s=i/t*Math.sin(Math.PI*this.step/30)*Math.PI/2;if(Target.scrollUp(s),Item.scrollUp(s),this.step>=30){var a=!1;if(Target.targets.forEach(function(t){t.shape.y-t.radius<e.I.y&&(a=!0)}),a)return new GameOver,void(this.state=this.stateNone);this.rowCount<3?(this.state=this.stateWave,this.step=0):this.textGuide?this.state=this.stateNone:this.state=this.stateAim}},e.prototype.stateAim=function(){this.step++,this.setShape()},e.prototype.stateBound=function(){this.interval++,this.interval/15<=this.ballCount?this.interval%15==0&&new Ball(this.x,this.y,Math.sin(this.dir)*this.ballSpeed,Math.cos(this.dir)*this.ballSpeed):0==Ball.balls.length&&(this.state=this.stateWave,this.step=0)},e.prototype.onTapToStart=function(){this.textGuide&&(GameObject.display.removeChild(this.textGuide),this.textGuide=null,this.state==this.stateNone&&(this.state=this.stateAim))},e.prototype.touchBegin=function(t){this.state==this.stateAim&&this.setDir(t.localX,t.localY)},e.prototype.touchMove=function(t){this.state==this.stateAim&&this.setDir(t.localX,t.localY)},e.prototype.touchEnd=function(t){this.state==this.stateAim&&(this.state=this.stateBound,this.interval=0)},e.prototype.addBall=function(){this.ballCount<this.ballMax?this.ballCount++:Score.I.addPoint(1),this.textBalls.text="x"+this.ballCount},e.I=null,e}(GameObject);__reflect(Aiming.prototype,"Aiming");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.texts[0]=Util.newTextField("GAME OVER",Util.width/10,33023,.5,.45,!0),GameObject.display.addChild(e.texts[0]),e.texts[1]=Util.newTextField("SCORE : "+Score.I.point.toFixed(),Util.width/12,33023,.5,.55,!0),GameObject.display.addChild(e.texts[1]),SDK&&Score.bestScore<Score.I.point&&(Score.bestScore=Score.I.point,Social.setScore(Score.I.point),e.texts[3]=Util.newTextField("NEW RECORD!",Util.width/13,33023,.5,.4,!0),egret.Tween.get(e.texts[3],{loop:!0}).to({alpha:0},500).to({alpha:1},500),GameObject.display.addChild(e.texts[3])),e.texts.forEach(function(t){GameObject.display.addChild(t)}),GameObject.display.once(egret.TouchEvent.TOUCH_TAP,function(t){return e.tap(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.display.removeChild(t)})},e.prototype.update=function(){},e.prototype.tap=function(t){GameObject.transit=Game.loadSceneGamePlay,this.destroy()},e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Background=function(t){function e(){var e=t.call(this)||this;return e.shape=new egret.Shape,e.shape.graphics.beginFill(15790840),e.shape.graphics.drawRect(0,0,Util.width,Util.height),e.shape.graphics.endFill(),GameObject.display.addChild(e.shape),GameObject.display.setChildIndex(e.shape,1),e}return __extends(e,t),e.prototype.update=function(){},e}(GameObject);__reflect(Background.prototype,"Background");var SDK=!0,Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return GameObject.initial(this.stage),Util.init(this),SDK?[4,Social.init()]:[3,2];case 1:t.sent(),t.label=2;case 2:return Game.loadSceneGamePlay(),egret.startTick(this.tickLoop,this),[2]}})})},e.prototype.tickLoop=function(t){return GameObject.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Score=function(t){function e(){var i=t.call(this)||this;return i.point=0,i.combo=0,i.text=null,i.textBest=null,e.I=i,i.point=0,i.text=Util.newTextField("SCORE : 0",Util.width/22,33023,.5,0,!0),GameObject.display.addChild(i.text),i.textBest=Util.newTextField("BEST : "+e.bestScore,Util.width/22,33023,0,0,!0),GameObject.display.addChild(i.textBest),i}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.text),this.text=null,GameObject.display.removeChild(this.textBest),this.textBest=null},e.prototype.update=function(){},e.prototype.addPoint=function(t){this.point+=t,this.text.text="SCORE : "+this.point.toFixed(),e.bestScore<this.point&&(this.textBest.text="BEST : "+this.point.toFixed())},e.prototype.breakTarget=function(){this.addPoint(1+this.combo),this.combo++},e.I=null,e.bestScore=0,e.bestRank=0,e}(GameObject);__reflect(Score.prototype,"Score");var Target=function(t){function e(i,s,a){var n=t.call(this)||this;return n.animFrameMax=8,n.animFrame=0,n.text=null,e.targets.push(n),n.hp=a,n.radius=TARGET_RADIUS_PER_WIDTH*Util.width,n.setShape(i,s,n.radius),n.text=Util.newTextField(""+n.hp,Util.width/18,16777215,i/Util.width,s/Util.height,!0),GameObject.display.addChild(n.text),n}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.targets=e.targets.filter(function(e){return e!=t}),GameObject.display.removeChild(this.text),this.text=null},e.prototype.setShape=function(t,i,s){null==this.shape?(this.shape=new egret.Shape,GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,2)):this.shape.graphics.clear(),this.shape.x=t,this.shape.y=i,this.shape.graphics.beginFill(e.getColor(this.hp)),this.shape.graphics.drawCircle(0,0,s),this.shape.graphics.endFill()},e.getColor=function(t){var i=Util.clamp((t-1)/(e.maxHp-1),0,1);return i=.5>=i?Util.colorLerp(15728704,15790080,2*i):Util.colorLerp(15790080,33023,2*i-1)},e.prototype.update=function(){if(this.text.text=""+this.hp.toFixed(),this.text.x=this.shape.x-.5*this.text.width,this.text.y=this.shape.y-.5*this.text.height,this.animFrame>0){this.animFrame--;var t=1+.3*this.animFrame/this.animFrameMax;this.shape.scaleX=this.shape.scaleY=t}},e.prototype.applyDamage=function(t){if(this.hp-=t,this.hp>0)this.animFrame=this.animFrameMax,this.setShape(this.shape.x,this.shape.y,this.radius);else{Score.I.breakTarget(),this.destroy();var e=this.shape.x,i=this.shape.y,s=this.radius;new EffectCircle(e,i,s)}},e.scrollUp=function(t){e.targets.forEach(function(e){e.shape.y+=t})},e.targets=[],e.maxHp=32,e}(GameObject);__reflect(Target.prototype,"Target");var Util=function(){function t(){}return t.init=function(t){this.height=t.stage.stageHeight,this.width=t.stage.stageWidth},t.random=function(t,e){return t+Math.random()*(e-t)},t.randomInt=function(t,e){return t=Math.floor(t),e=Math.floor(e)+.999,Math.floor(t+Math.random()*(e-t))},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.colorLerp=function(t,e,i){var s=1-i,a=((16711680&t)*s+(16711680&e)*i&16711680)+((65280&t)*s+(65280&e)*i&65280)+((255&t)*s+(255&e)*i&255);return a},t.newTextField=function(e,i,s,a,n,r){var o=new egret.TextField;return o.text=e,o.bold=r,o.size=i,o.textColor=s,o.x=(t.width-o.width)*a,o.y=(t.height-o.height)*n,o},t}();__reflect(Util.prototype,"Util");var Sdk=function(){function t(){}return t.loadSdk=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(s){switch(s.label){case 0:return console.log("============================================================"),console.log("Liberapp.loadSdk:"),this.env=this.detectMode(location.origin),console.log("env: ",this.env),t=this.resolveSdkUrl(this.sdkPath),console.log("srcUrl: ",t),[4,this.loadScript(t)];case 1:return e=s.sent(),console.log("script:",e),i=window.LiberappSdk,"egret-wing"!==this.env?[3,3]:[4,i.enableDebug()];case 2:s.sent(),s.label=3;case 3:return console.log("liberappSdk:",i),[2,i]}})})},t.detectMode=function(t){return/^https:\/\/(.+)\.a\.liberapp\.net$/.test(t)?"production":/^https:\/\/(.+)\.a\.staging.\.liberapp\.net$/.test(t)?"staging":/^https:\/\/(.+)\.a\.development\.liberapp\.net$/.test(t)?"development":"egret-wing"},t.resolveSdkUrl=function(t){var e=this.baseUrls[this.env];return""+e+t},t.loadScript=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,i){var s=document.createElement("script");s.async=!1,s.src=t,s.onload=function(){return e(s)},s.onerror=function(){return i(new Error("Can not load script: src:"+t))},document.head.append(s)})]})})},t.baseUrls={production:"https://liberapp.net",staging:"https://staging.liberapp.net",development:"https://localhost","egret-wing":"https://staging.liberapp.net"},t.sdkPath="/dist/sdk/liberapp-ja-0_9.js",t}();__reflect(Sdk.prototype,"Sdk");var Social=function(){function t(){}return t.init=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,s,a,n,r,o,h,l;return __generator(this,function(c){switch(c.label){case 0:return[4,Sdk.loadSdk()];case 1:return t=c.sent(),this.sdk=t,Toast.show({text:"ログイン中・・・",delay:3e4,canHide:!0}),[4,t.initializeAsync()];case 2:return c.sent(),[4,t.startGameAsync()];case 3:return c.sent(),Toast.show({text:this.playerName+"さんようこそ！",delay:3e4,canHide:!0}),e=this,[4,t.getLeaderboardAsync("default")];case 4:return e.leaderboard=c.sent(),[4,Promise.all([this.leaderboard.getEntryCountAsync(),this.leaderboard.getEntriesAsync(3,0),this.leaderboard.getPlayerEntryAsync(),this.sdk.player.getDataAsync(["level"])])];case 5:return i=c.sent(),s=i[0],a=i[1],n=i[2],r=i[3],this.playerEntry=n,this.rawData=r,this.hasBest?Toast.show({text:"今のところ"+s+"人中"+this.bestRank+"位です",delay:3e3}):(o=a[0],o&&(console.log(o),h=o.getPlayer().getName(),l=o.getScore(),Toast.show({text:s+"人が遊んでいます!\n一番は"+h+"さん\nスコアは"+l+"です",delay:3e3}))),[2]}})})},Object.defineProperty(t,"hasBest",{get:function(){return!!this.myBestEntry},enumerable:!0,configurable:!0}),Object.defineProperty(t,"bestScore",{get:function(){return this.hasBest?this.myBestEntry.getScore():0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"bestRank",{get:function(){return this.hasBest?this.myBestEntry.getRank():void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"playerEntry",{set:function(e){console.log("myBest:",this.myBestEntry,e),this.myBestEntry=e,Score.bestScore=t.bestScore,Score.bestRank=t.bestRank},enumerable:!0,configurable:!0}),t.setScore=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("setScore "+t),Toast.show({text:"ハイスコアを送信中",delay:3e4,canHide:!0}),e=this,[4,this.leaderboard.setScoreAsync(t)];case 1:return e.playerEntry=i.sent(),Toast.show({text:"順位は"+this.bestRank+"位でした",delay:3e3}),[2]}})})},Object.defineProperty(t,"playerName",{get:function(){return this.sdk.player.getName()||"名無し"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"hasData",{get:function(){return!!this.rawData},enumerable:!0,configurable:!0}),Object.defineProperty(t,"level",{get:function(){return this.hasData&&"level"in this.rawData?this.rawData.level:0},enumerable:!0,configurable:!0}),t.setLevel=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.rawData.level=t,console.log("setLevel "+t+" "+this.rawData.level),Toast.show({text:"達成レベルを送信中",delay:3e4,canHide:!0}),[4,this.sdk.player.setDataAsync({level:t})];case 1:return e.sent(),Toast.show({text:"送信完了",delay:1500}),[2]}})})},t}();__reflect(Social.prototype,"Social");var DefaultToastOptions={text:"",delay:3e3,canHide:!1},Toast=function(t){function e(e){var i=t.call(this)||this;return i.queue=[],i.rect=new eui.Rect,i.rect.alpha=0,i.label=new eui.Label,i.label.maxWidth=e,i.rect.addEventListener(eui.UIEvent.CREATION_COMPLETE,i.onRectCreationComplete,i),i.label.addEventListener(eui.UIEvent.RESIZE,i.onLabelResized,i),GameObject.display.addChild(i.rect),i}return __extends(e,t),e.prototype.update=function(){},e.show=function(t){var i=__assign({},DefaultToastOptions,t);this.I||(this.I=new e(.6*Util.width)),this.I.show(i)},e.prototype.onDestroy=function(){var t=e.I;e.I=void 0,t&&(t.rect.parent.removeChild(t.rect),t.rect.removeChildren(),t.rect=void 0,t.label=void 0)},e.prototype.show=function(t){if(console.log("Toast.show"),this.currentOptions){if(!this.currentOptions.canHide)return void this.queue.push(t);this.currentTween.setPaused(!0),this.currentTween=void 0,this.currentOptions=void 0,this.queue=[]}this.currentOptions=t,this.toastText=t.text,this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:1},300).wait(t.delay).call(this.onStartHide,this)},e.prototype.onStartHide=function(){console.log("Toast.onStartHide"),void 0!==this.currentTween&&(this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:0},300).call(this.onCompleteHide,this))},e.prototype.onCompleteHide=function(){if(console.log("Toast.onCompleteHide"),this.currentTween=void 0,this.currentOptions=void 0,0===this.queue.length)return void this.destroy();var t=this.queue.shift();this.show(t)},e.prototype.onRectCreationComplete=function(){console.log("Toast.onRectCreationComplete"),this.rect.fillColor=0,this.rect.fillAlpha=.6,this.rect.horizontalCenter=0,this.rect.verticalCenter=0,this.rect.ellipseWidth=30,this.rect.ellipseHeight=30,this.label.x=20,this.label.y=20,this.label.size=28,this.rect.addChild(this.label),this.toastText=""},Object.defineProperty(e.prototype,"toastText",{set:function(t){console.log("Toast.toastText:"),this.label.text=t},enumerable:!0,configurable:!0}),e.prototype.onLabelResized=function(){console.log("Toast.onLabelResized:"),this.rect.width=this.label.width+40,this.rect.height=this.label.height+40,this.rect.x=(Util.width-this.rect.width)/2,this.rect.y=(Util.height-this.rect.height)/2},e}(GameObject);__reflect(Toast.prototype,"Toast");