var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},GameObject=function(){function t(){this.shape=null,t.objects.push(this)}return t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.display=e},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t["delete"](),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t["delete"](),!1})},t.prototype["delete"]=function(){this.onDestroy(),this.shape&&(t.display.removeChild(this.shape),this.shape=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var Aiming=function(t){function e(){var i=t.call(this)||this;return i.lineColor=33023,i.dir=0,i.ballMax=9,i.ballCount=2,i.interval=0,i.rowCount=0,i.state=i.stateWave,i.step=0,i.shapeBox=null,i.textGuide=null,i.textBalls=null,e.I=i,i.x=.5*Util.width,i.y=.1*Util.height,i.ballSpeed=BALL_RADIUS_PER_WIDTH*Util.width*.75,i.shapeBox=new egret.Shape,i.shapeBox.graphics.beginFill(49407),i.shapeBox.graphics.drawCircle(i.x,i.y,BALL_RADIUS_PER_WIDTH*Util.width*.75),i.shapeBox.graphics.endFill(),i.shapeBox.graphics.lineStyle(5,8421520),i.shapeBox.graphics.moveTo(0,i.y),i.shapeBox.graphics.lineTo(.45*Util.width,i.y),i.shapeBox.graphics.moveTo(.55*Util.width,i.y),i.shapeBox.graphics.lineTo(Util.width,i.y),GameObject.display.addChild(i.shapeBox),i.textGuide=Util.newTextField("スワイプでねらって\nボールをおとせ！",Util.width/18,33023,.5,.3,!0),i.textBalls=Util.newTextField("x"+i.ballCount,Util.width/22,33023,.55,.06,!0),GameObject.display.addChild(i.textGuide),GameObject.display.addChild(i.textBalls),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return i.touchBegin(t)},i),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return i.touchMove(t)},i),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_END,function(t){return i.touchEnd(t)},i),i}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return t.touchBegin(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){return t.touchMove(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_END,function(e){return t.touchEnd(e)},this),this.shapeBox&&(GameObject.display.removeChild(this.shapeBox),this.shapeBox=null),this.textGuide&&(GameObject.display.removeChild(this.textGuide),this.textGuide=null),this.textBalls&&(GameObject.display.removeChild(this.textBalls),this.textBalls=null),e.I=null},e.prototype.setShape=function(){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape;var t=this.x,e=this.y,i=Math.sin(this.dir)*this.ballSpeed,s=Math.cos(this.dir)*this.ballSpeed,a=BALL_RADIUS_PER_WIDTH*Util.width,h=(15&this.step)/16;t+=i*h,e+=s*h,i*=1-.01*h,s*=1-.01*h,s+=.01*a*h,this.shape.graphics.lineStyle(5*h,this.lineColor),this.shape.graphics.drawCircle(t,e,.02*a),this.shape.graphics.lineStyle(5,this.lineColor);for(var r=0;20>r;r++)t+=i,e+=s,i*=.99,s*=.99,s+=.01*a,this.shape.graphics.drawCircle(t,e,.02*a);t+=i,e+=s,i*=.99,s*=.99,s+=.01*a,this.shape.graphics.lineStyle(5*(1-h),this.lineColor),this.shape.graphics.drawCircle(t,e,.02*a),GameObject.display.addChild(this.shape)},e.prototype.setDir=function(t,e){var i=this.x,s=this.y,a=t-i,h=e-s;0>h&&(h=0),this.dir=Util.clamp(Math.atan2(a,h),.45*-Math.PI,.45*+Math.PI)},e.prototype.update=function(){this.state()},e.prototype.stateWave=function(){Score.I.combo=0,this.rowCount++;for(var t=Util.clamp(1-this.rowCount/30,.45,1),e=Util.height+TARGET_RADIUS_PER_WIDTH*Util.width,i=Math.min(this.rowCount,Target.maxHp),s=t*Util.random(0,1);1>s;){var a=Util.width*(TARGET_RADIUS_PER_WIDTH+s*(1-TARGET_SIZE_PER_WIDTH));this.ballCount<this.ballMax&&2==Util.randomInt(0,3)?new Item(a,e):new Target(a,e,Util.randomInt(Math.max(1,.33*i),i)),s+=t*Util.random(.5,1.5)}this.state=this.stateScroll,this.step=0},e.prototype.stateScroll=function(){this.step++;var t=30,i=TARGET_SIZE_PER_WIDTH*Util.width*-1.25,s=i/t*Math.sin(Math.PI*this.step/30)*Math.PI/2;if(Target.scrollUp(s),Item.scrollUp(s),this.step>=30){var a=!1;if(Target.targets.forEach(function(t){t.shape.y-t.radius<e.I.y&&(a=!0)}),a)return new GameOver,void(this.state=this.stateGameOver);this.rowCount<3?this.state=this.stateWave:this.state=this.stateAim}},e.prototype.stateAim=function(){this.step++,this.setShape()},e.prototype.stateBound=function(){this.interval++,this.interval/15<=this.ballCount?this.interval%15==0&&new Ball(this.x,this.y,Math.sin(this.dir)*this.ballSpeed,Math.cos(this.dir)*this.ballSpeed):0==Ball.balls.length&&(this.state=this.stateWave)},e.prototype.stateGameOver=function(){},e.prototype.touchBegin=function(t){this.state==this.stateAim&&(this.setDir(t.localX,t.localY),this.textGuide&&(GameObject.display.removeChild(this.textGuide),this.textGuide=null))},e.prototype.touchMove=function(t){this.state==this.stateAim&&this.setDir(t.localX,t.localY)},e.prototype.touchEnd=function(t){this.state==this.stateAim&&(this.state=this.stateBound,this.interval=0)},e.prototype.addBall=function(){this.ballCount<this.ballMax?this.ballCount++:Score.I.point+=1,this.textBalls.text="x"+this.ballCount},e.I=null,e}(GameObject);__reflect(Aiming.prototype,"Aiming");var Ball=function(t){function e(i,s,a,h){var r=t.call(this)||this;return e.balls.push(r),r.radius=BALL_SIZE_PER_WIDTH*Util.width*.5,r.setShape(i,s,r.radius),r.vx=a,r.vy=h,r}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.balls=e.balls.filter(function(e){return e!=t})},e.prototype.setShape=function(t,e,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(49407),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){var t=this;this.shape.x+=this.vx,this.shape.y+=this.vy,this.vx*=.99,this.vy*=.99,this.vy+=.01*this.radius;var e=null,i=0;if(Target.targets.forEach(function(s){var a=s.shape.x-t.shape.x,h=s.shape.y-t.shape.y,r=Math.pow(a,2)+Math.pow(h,2);if(e)i>r&&(e=s,i=r);else{var o=Math.pow(s.radius+t.radius,2);o>r&&(e=s,i=r)}}),e){var s=this.shape.x-e.shape.x,a=this.shape.y-e.shape.y,h=Math.sqrt(Math.pow(s,2)+Math.pow(a,2)),r=s/h,o=a/h,n=r*this.vx+o*this.vy;if(0>n){this.vx+=-1.8*n*r,this.vy+=-1.8*n*o;var l=.2*this.radius;h=Math.pow(this.vx,2)+Math.pow(this.vy,2),h<Math.pow(l,2)&&(h=l/Math.sqrt(h),this.vx*=h,this.vy*=h),e.applyDamage(1,-r,-o)}}this.boundWall()},e.prototype.boundWall=function(){Math.pow(this.shape.x-.5*Util.width,2)>Math.pow(.5*Util.width-this.radius,2)&&(this.vx*=-.9,this.shape.x+=this.vx),this.vy<0&&this.shape.y<this.radius&&(this.vy*=-.9,this.shape.y+=this.vy),this.shape.y>Util.height&&this.destroy()},e.balls=[],e}(GameObject);__reflect(Ball.prototype,"Ball");var EffectCircle=function(t){function e(i,s,a,h){void 0===h&&(h=16760832);var r=t.call(this)||this;return r.frame=e.maxFrame,r.radius=a,r.color=h,r.setShape(i,s,r.radius),r}return __extends(e,t),e.prototype.setShape=function(t,i,s){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.lineStyle(3+10*(this.frame/e.maxFrame),this.color),this.shape.graphics.drawCircle(0,0,s),GameObject.display.addChild(this.shape),this.shape.x=t,this.shape.y=i},e.prototype.update=function(){return--this.frame<=0?void this.destroy():(this.radius*=1.03,void this.setShape(this.shape.x,this.shape.y,this.radius))},e.maxFrame=30,e}(GameObject);__reflect(EffectCircle.prototype,"EffectCircle");var EffectLine=function(t){function e(e,i,s,a,h){void 0===h&&(h=16760832);var r=t.call(this)||this;return r.frame=0,r.x=e,r.y=i,r.vx=s,r.vy=a,r.color=h,r.setShape(0),r}return __extends(e,t),e.prototype.setShape=function(t){this.shape&&GameObject.display.removeChild(this.shape);var e=Math.sin(t*Math.PI*.5),i=1-Math.cos(t*Math.PI*.5);this.shape=new egret.Shape,this.shape.graphics.lineStyle(3+10*(1-t),this.color),this.shape.graphics.moveTo(this.x+this.vx*e,this.y+this.vy*e),this.shape.graphics.lineTo(this.x+this.vx*i,this.y+this.vy*i),GameObject.display.addChild(this.shape)},e.prototype.update=function(){if(++this.frame>=e.maxFrame)return void this.destroy();var t=this.frame/e.maxFrame;this.setShape(t)},e.maxFrame=30,e}(GameObject);__reflect(EffectLine.prototype,"EffectLine");var BALL_SIZE_PER_WIDTH=1/16,BALL_RADIUS_PER_WIDTH=.5*BALL_SIZE_PER_WIDTH,TARGET_SIZE_PER_WIDTH=1/6,TARGET_RADIUS_PER_WIDTH=.5*TARGET_SIZE_PER_WIDTH,Game=function(){function t(){}return t.loadSceneGamePlay=function(){new Background,new Score,new Aiming},t}();__reflect(Game.prototype,"Game");var Background=function(t){function e(){var e=t.call(this)||this;return e.shape=new egret.Shape,e.shape.graphics.beginFill(15790840),e.shape.graphics.drawRect(0,0,Util.width,Util.height),e.shape.graphics.endFill(),GameObject.display.addChild(e.shape),GameObject.display.setChildIndex(e.shape,1),e}return __extends(e,t),e.prototype.update=function(){},e}(GameObject);__reflect(Background.prototype,"Background");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.textGameOver=null,e.textScore=null,e.textGameOver=Util.newTextField("GAME OVER",Util.width/10,33023,.5,.45,!0),GameObject.display.addChild(e.textGameOver),e.textScore=Util.newTextField("SCORE : "+Score.I.point.toFixed(),Util.width/12,33023,.5,.55,!0),GameObject.display.addChild(e.textScore),Score.I.point>=Score.I.bestScore&&egret.localStorage.setItem("bestScore",Score.I.point.toFixed()),GameObject.display.once(egret.TouchEvent.TOUCH_TAP,function(t){return e.tap(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.textGameOver),this.textGameOver=null,GameObject.display.removeChild(this.textScore),this.textScore=null},e.prototype.update=function(){},e.prototype.tap=function(t){GameObject.transit=Game.loadSceneGamePlay,this.destroy()},e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Item=function(t){function e(i,s){var a=t.call(this)||this;return e.items.push(a),a.radius=BALL_RADIUS_PER_WIDTH*Util.width*.8,a.setShape(i,s,a.radius),a}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.items=e.items.filter(function(e){return e!=t})},e.prototype.setShape=function(t,e,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(49407),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,2),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){var t=this;Ball.balls.some(function(e,i){var s=e.shape.x-t.shape.x,a=e.shape.y-t.shape.y;return Math.pow(s,2)+Math.pow(a,2)<=Math.pow(e.radius+t.radius,2)?(Aiming.I.addBall(),new EffectCircle(t.shape.x,t.shape.y,t.radius,49407),t.destroy(),!0):!1})},e.scrollUp=function(t){e.items.forEach(function(e){e.shape.y+=t,e.shape.y<=0&&e.destroy()})},e.items=[],e}(GameObject);__reflect(Item.prototype,"Item");var Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){GameObject.initial(this.stage),Util.init(this),Game.loadSceneGamePlay(),egret.startTick(this.tickLoop,this)},e.prototype.tickLoop=function(t){return GameObject.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Score=function(t){function e(){var i=t.call(this)||this;i.point=0,i.combo=0,i.bestScore=0,i.text=null,i.textBest=null,e.I=i,i.point=0,i.text=Util.newTextField("SCORE : 0",Util.width/22,33023,.5,0,!0),GameObject.display.addChild(i.text);var s=egret.localStorage.getItem("bestScore");return null==s&&(s="50",egret.localStorage.setItem("bestScore",s)),i.bestScore=parseInt(s),i.textBest=Util.newTextField("BEST : "+s,Util.width/22,33023,0,0,!0),GameObject.display.addChild(i.textBest),i}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.text),this.text=null,GameObject.display.removeChild(this.textBest),this.textBest=null},e.prototype.update=function(){this.text.text="SCORE : "+this.point.toFixed(),this.bestScore<this.point&&(this.bestScore=this.point,this.textBest.text="BEST : "+this.point.toFixed())},e.prototype.breakTarget=function(){this.point+=1+this.combo,this.combo++},e.I=null,e}(GameObject);__reflect(Score.prototype,"Score");var Target=function(t){function e(i,s,a){var h=t.call(this)||this;return h.animFrameMax=8,h.animFrame=0,h.text=null,e.targets.push(h),h.hp=a,h.radius=TARGET_RADIUS_PER_WIDTH*Util.width,h.setShape(i,s,h.radius),h.text=Util.newTextField(""+h.hp,Util.width/18,16777215,i/Util.width,s/Util.height,!0),GameObject.display.addChild(h.text),h}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.targets=e.targets.filter(function(e){return e!=t}),GameObject.display.removeChild(this.text),this.text=null},e.prototype.setShape=function(t,i,s){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(e.getColor(this.hp)),this.shape.graphics.drawCircle(0,0,s),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,2),this.shape.x=t,this.shape.y=i},e.getColor=function(t){var i=Util.clamp((t-1)/(e.maxHp-1),0,1);return i=.5>=i?Util.colorLerp(15728704,15790080,2*i):Util.colorLerp(15790080,33023,2*i-1)},e.prototype.update=function(){if(this.text.text=""+this.hp.toFixed(),this.text.x=this.shape.x-.5*this.text.width,this.text.y=this.shape.y-.5*this.text.height,this.animFrame>0){this.animFrame--;var t=1+.3*this.animFrame/this.animFrameMax;this.shape.scaleX=this.shape.scaleY=t}},e.prototype.applyDamage=function(t){if(this.hp-=t,this.hp>0)this.animFrame=this.animFrameMax,this.setShape(this.shape.x,this.shape.y,this.radius);else{Score.I.breakTarget(),this.destroy();var e=this.shape.x,i=this.shape.y,s=this.radius;new EffectCircle(e,i,s);for(var a=0;5>a;a++){var h=Util.random(-Math.PI,+Math.PI),r=Math.sin(h),o=Math.cos(h),n=s*(2+.5*a);new EffectLine(e+r*s,i+o*s,r*n,o*n)}}},e.scrollUp=function(t){e.targets.forEach(function(e){e.shape.y+=t})},e.targets=[],e.maxHp=35,e}(GameObject);__reflect(Target.prototype,"Target");var Util=function(){function t(){}return t.init=function(t){this.height=t.stage.stageHeight,this.width=t.stage.stageWidth},t.random=function(t,e){return t+Math.random()*(e-t)},t.randomInt=function(t,e){return Math.floor(t+Math.random()*(e+.999-t))},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.colorLerp=function(t,e,i){var s=1-i,a=((16711680&t)*s+(16711680&e)*i&16711680)+((65280&t)*s+(65280&e)*i&65280)+((255&t)*s+(255&e)*i&255);return a},t.newTextField=function(e,i,s,a,h,r){var o=new egret.TextField;return o.text=e,o.bold=r,o.size=i,o.textColor=s,o.x=(t.width-o.width)*a,o.y=(t.height-o.height)*h,o},t}();__reflect(Util.prototype,"Util");